import { AwilixContainer, Lifetime } from "awilix";
import testDatasource from "./infrastructure/test.datasource";

const awilix = require("awilix");

let container;

export const setUpAwilix = () => {
    container = awilix.createContainer({
        injectionMode: awilix.InjectionMode.PROXY,
    });
    const repo =
        ({ value }: any) =>
        () =>
            console.log("repo");

    container.register({
        repo: awilix.asFunction(repo),
        value: awilix.asValue("casa"),
        testDatasource: awilix.asFunction(testDatasource),
    });
    container.loadModules(["core/ports/*.repository.ts"], {
        resolverOptions: {
            lifetime: Lifetime.SINGLETON,
        },
    });
};

export default container;
